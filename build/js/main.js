function updateScrollbar(){$messages.mCustomScrollbar("update").mCustomScrollbar("scrollTo","bottom",{scrollInertia:10,timeout:0})}function setDate(){d=new Date,m!=d.getMinutes()&&(m=d.getMinutes(),m<10&&(m="0"+m),$('<div class="timestamp">'+d.getHours()+":"+m+"</div>").appendTo($(".message:last")),$('<div class="checkmark-sent-delivered">&check;</div>').appendTo($(".message:last")),$('<div class="checkmark-read">&check;</div>').appendTo($(".message:last")))}function insertMessage(){var e=$(".message-input").val();return""!==$.trim(e)&&($('<div class="message message-personal">'+e+"</div>").appendTo($(".mCSB_container")).addClass("new"),setDate(),$(".message-input").val(null),updateScrollbar(),void setTimeout(function(){secondMessage()},1e3+20*Math.random()*100))}function loadingMessage(){$('<div class="message loading new"><figure class="avatar"><img src="http://askavenue.com/img/17.jpg" /></figure><span></span></div>').appendTo($(".mCSB_container")),updateScrollbar()}function botMessage(e){loadingMessage(),setTimeout(function(){$(".message.loading").remove(),$('<div class="message new"><figure class="avatar"><img src="http://askavenue.com/img/17.jpg" /></figure>'+e+"</div>").appendTo($(".mCSB_container")).addClass("new"),setDate(),updateScrollbar()},1e3+20*Math.random()*100)}function secondMessage(){loadingMessage(),setTimeout(function(){$(".message.loading").remove(),$('<div class="message new"><figure class="avatar"><img src="http://askavenue.com/img/17.jpg" /></figure>Как вам удобнее получить ответ?<form action="" id="answer"><input type="radio" name="how" id="email"><label for="email">По email </label><input type="radio" name="how" id="tel"><label for="tel">По телефону </label><input type="submit" value="Ответить"></form></div>').appendTo($(".mCSB_container")).addClass("new"),setDate(),updateScrollbar()},1e3+20*Math.random()*100)}function emailForm(){loadingMessage(),setTimeout(function(){$(".message.loading").remove(),$('<div class="message new"><figure class="avatar"><img src="http://askavenue.com/img/17.jpg" /></figure>Оставьте свое имя и email и мы вам ответим<form action="" id="email-form"><input type="text" name="name" id="name" placeholder="Введите ваше имя" required><input type="email" name="email" id="email" placeholder="Введите ваш email" required><input type="submit" value="Ответить"></form></div>').appendTo($(".mCSB_container")).addClass("new"),setDate(),updateScrollbar()},1e3+20*Math.random()*100)}function telForm(){loadingMessage(),setTimeout(function(){$(".message.loading").remove(),$('<div class="message new"><figure class="avatar"><img src="http://askavenue.com/img/17.jpg" /></figure>Оставьте свое имя и номер телефона и мы вам позвоним<form action="" id="tel-form"><input type="text" name="name" id="name" placeholder="Введите ваше имя" required><input type="tel" name="tel" id="tel" placeholder="Введите ваш телефон" required><input type="submit" value="Ответить"></form></div>').appendTo($(".mCSB_container")).addClass("new"),setDate(),updateScrollbar()},1e3+20*Math.random()*100)}function formSubmit(e){var a=$(e).serialize();$.ajax({type:"POST",url:"../mail.php",data:a,success:function(e){console.log("форма отправлена"+e),botMessage("Спасибо! Мы скоро с вами свяжемся!")},error:function(e,a){console.log("Возникла ошибка: "+e.responseCode)}})}var $messages=$(".messages-content"),d,h,m,i=0;$(window).load(function(){$messages.mCustomScrollbar(),setTimeout(function(){botMessage("Чего изволите, сударь?")},100)}),$(".message-submit").click(function(){insertMessage()}),$(window).on("keydown",function(e){if(13===e.which)return insertMessage(),!1}),$("body").on("submit","#answer",function(e){var a=$('#answer input[id="email"]'),s=$('#answer input[id="tel"]');a.is(":checked")?emailForm():s.is(":checked")?telForm():(botMessage("Может попробуем еще раз?"),setTimeout(function(){secondMessage()},500)),e.preventDefault()}),$("body").on("submit","#email-form",function(e){e.preventDefault(),formSubmit("#email-form")}),$("body").on("submit","#tel-form",function(e){e.preventDefault(),formSubmit("#tel-form")}),$(".button").click(function(){$(".messages-wrap").slideToggle().css("display","flex"),$(".messenger").toggleClass("active")});